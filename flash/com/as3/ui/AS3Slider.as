package com.as3.ui{	import flash.display.Sprite;	import flash.display.MovieClip;	import flash.events.MouseEvent;	import flash.events.Event;	import flash.utils.setTimeout;	import flash.geom.Rectangle;	import com.as3.ui.*;	import com.as3.utils.*;	public class AS3Slider extends Sprite	{		protected var _skin:Sprite;		protected var _mg:int;		protected var _h:Boolean;		protected var _l:Sprite=null;		protected var _m:Sprite=null;		protected var _r:Sprite=null;		protected var _bk:Sprite=null;		protected var _pt:Sprite=null;		protected var _cx:int;		protected var _cy:int;		protected var _id:String;		protected var _hit_spr:Sprite;		protected var _draging:Boolean;		protected var _lastpos:Number=-1;		public function AS3Slider(obj:Object)		{			super();			init(obj);		}		public function init(obj:Object):void		{			_skin=obj.skin;			_mg=obj.margin;			_h=obj.horizontal;			_cx=obj.cx;			_cy=obj.cy;			_id=obj.id;			_draging=false;			_skin.x=0;			_skin.y=0;			_bk=_skin["bk_mc"];			if (_skin["left_mc"]!=undefined) _l=_skin["left_mc"];			if (_skin["mid_mc"]!=undefined) _m=_skin["mid_mc"];			if (_skin["right_mc"]!=undefined) _r=_skin["right_mc"];			if (_skin["pt_mc"]!=undefined) _pt=_skin["pt_mc"];			_hit_spr = new Sprite();			if (_h) {				if (_l) _l.x=_mg;				if (_m) _m.x=_mg;				if (_r) _r.x=_mg;				AS3Utils.drawRect(_hit_spr, 0, 0, 1, _bk.height, 0xffffff, 0);				_hit_spr.x=_mg;			} else {				if (_l) _l.y=_mg;				if (_m) _m.y=_mg;				if (_r) _r.y=_mg;				AS3Utils.drawRect(_hit_spr, 0, 0, _bk.width, 1, 0xffffff, 0);				_hit_spr.y=_mg;			}			_hit_spr.buttonMode = true;			_hit_spr.addEventListener(MouseEvent.CLICK,hitHandler);			_skin.addChild(_hit_spr);			if (_pt) {				_pt.buttonMode = true;				_pt.addEventListener(MouseEvent.MOUSE_DOWN,dragHandler);				_skin.setChildIndex(_pt,_skin.numChildren-1);			}			addChild(_skin);		}		private function dragEndHandler(e:MouseEvent):void		{			_draging=false;			_lastpos=-1;			stage.removeEventListener(MouseEvent.MOUSE_MOVE, moveHandler);			stage.removeEventListener(MouseEvent.MOUSE_UP, dragEndHandler);		}		private function dragHandler(e:MouseEvent):void		{			_draging=true;			stage.addEventListener(MouseEvent.MOUSE_MOVE, moveHandler);			stage.addEventListener(MouseEvent.MOUSE_UP, dragEndHandler);		}		private function calcPos():Number		{			var pos:Number;			if (_h) {				pos=mouseX-_mg;				if (pos<0) pos=0;				else if (pos>_bk.width-_mg-_mg) pos=_bk.width-_mg-_mg;				if (_l) _l.width=pos;				if (_pt) _pt.x=_mg+pos;				pos=pos/(_bk.width-_mg-_mg);			} else {				pos=mouseY-_mg;				if (pos<0) pos=0;				else if (pos>_bk.height-_mg-_mg) pos=_bk.height-_mg-_mg;				if (_l) _l.height=pos;				if (_pt) _pt.y=_mg+pos;				pos=pos/(_bk.height-_mg-_mg);			}			return pos;		}		private function moveHandler(e:MouseEvent):void		{			if(e.buttonDown) {				var pos:Number=calcPos();				if (_lastpos!=pos){					_lastpos=pos;					dispatchEvent(new AS3Event(AS3Event.SLIDER_PREVIEW,_id,pos));				}			}		}		private function hitHandler(e:MouseEvent):void		{			dispatchEvent(new AS3Event(AS3Event.SLIDER_SEEK,_id,calcPos()));		}		public function resize(w:int,h:int,obj:*) : void		{			if (_draging) return;			var pos:Number,buf:Number;			if (_cx==-1) w=_bk.width;			else w+=_cx;			if (_cy==-1) h=_bk.height;			else h+=_cy;			if (_h) {				_bk.width=w;				w-=_mg+_mg;				_hit_spr.width=w;				pos=w*obj["pos"];				buf=w*obj["buf"];				if (_l) _l.width=pos;				if (_pt) _pt.x=_mg+pos;				if (_m) _m.width=buf;				if (_r) _r.width=w;			} else {				_bk.height=h;				h-=_mg+_mg;				_hit_spr.height=h;				pos=h*obj["pos"];				buf=h*obj["buf"];				if (_l) _l.height=pos;				if (_pt) _pt.y=_mg+pos;				if (_m) _m.height=buf;				if (_r) _r.height=h;			}		}	}}